(window.webpackJsonp=window.webpackJsonp||[]).push([[13,14,15,16,17],{440:function(e,t,r){var content=r(452);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(29).default)("662a6ece",content,!1,{sourceMap:!1})},450:function(e,t,r){var content=r(465);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(29).default)("2530e80d",content,!1,{sourceMap:!1})},451:function(e,t,r){"use strict";r(440)},452:function(e,t,r){var o=r(28)(!1);o.push([e.i,".email-code{width:33%;height:38px;float:right}.email-code img{cursor:pointer;vertical-align:middle;height:38px}",""]),e.exports=o},453:function(e,t,r){var content=r(467);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(29).default)("50524426",content,!1,{sourceMap:!1})},463:function(e,t,r){"use strict";r.r(t);r(97);var o=r(191),l={props:{user:{type:Object}},data:function(){return{emailRules:{email:[{required:!0,message:"邮箱地址不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]},{required:!0,validator:function(e,t,r){Object(o.b)(t).then((function(e){!0===e.data?r():r(new Error("邮箱已经存在"))}))},trigger:"blur"}],password:[{required:!0,message:"密码不能为",trigger:"blur"}],code:[{required:!0,message:"验证码不能为空",trigger:"blur"}]},emailForm:{password:"",email:"",code:"",uuid:""},codeUrl:"",loading:!1,isShow:!1,count:0}},created:function(){this.getCode()},watch:{user:function(e,t){this.emailForm.email=this.handleCampusUrl(e.avatar)}},methods:{getCode:function(){var e=this;Object(o.f)().then((function(t){e.captchaEnabled=void 0===t.captchaEnabled||t.captchaEnabled,e.captchaEnabled&&(e.codeUrl="data:image/gif;base64,"+t.img,e.emailForm.uuid=t.uuid)}))},handleEmail:function(){var e=this;this.$refs.emailForm.validate((function(t){t&&(e.loading=!0,Object(o.a)(e.emailForm).then((function(t){e.$message({message:t.msg,type:"success"}),e.loading=!1,e.getCode(),e.verification()})).catch((function(){e.loading=!1,e.getCode()})))}))},verification:function(){var e=this;this.isShow=!0,this.count=60;var t=setInterval((function(){e.count--,e.count<=0&&(e.isShow=!1,clearInterval(t))}),1e3)}}},n=(r(451),r(18)),component=Object(n.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"emailForm",attrs:{model:e.emailForm,rules:e.emailRules}},[r("h3",[e._v("密码验证")]),e._v(" "),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"密码"},model:{value:e.emailForm.password,callback:function(t){e.$set(e.emailForm,"password",t)},expression:"emailForm.password"}},[r("svg-icon",{staticClass:"el-input__icon input-icon",attrs:{slot:"prefix","icon-class":"password"},slot:"prefix"})],1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"email"}},[r("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"邮箱"},model:{value:e.emailForm.email,callback:function(t){e.$set(e.emailForm,"email",t)},expression:"emailForm.email"}},[r("svg-icon",{staticClass:"el-input__icon input-icon",attrs:{slot:"prefix","icon-class":"user"},slot:"prefix"})],1)],1),e._v(" "),r("el-form-item",{attrs:{prop:"code"}},[r("el-input",{staticStyle:{width:"63%"},attrs:{"auto-complete":"off",placeholder:"验证码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleEmail.apply(null,arguments)}},model:{value:e.emailForm.code,callback:function(t){e.$set(e.emailForm,"code",t)},expression:"emailForm.code"}},[r("svg-icon",{staticClass:"el-input__icon input-icon",attrs:{slot:"prefix","icon-class":"validCode"},slot:"prefix"})],1),e._v(" "),r("div",{staticClass:"email-code"},[r("img",{staticClass:"email-code-img",attrs:{src:e.codeUrl},on:{click:e.getCode}})])],1),e._v(" "),r("el-form-item",{staticStyle:{width:"100%"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{loading:e.loading,size:"medium",type:e.isShow?"info":"primary",disabled:e.isShow},nativeOn:{click:function(t){return t.preventDefault(),e.handleEmail.apply(null,arguments)}}},[e.loading?r("span",[e._v("请 求 中...")]):r("span",[e._v(e._s(e.isShow?e.count:"开始绑定"))])])],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{SvgIcon:r(189).default})},464:function(e,t,r){"use strict";r(450)},465:function(e,t,r){var o=r(28)(!1);o.push([e.i,'.user-info-head[data-v-19b8580e]{position:relative;display:inline-block;height:120px}.user-info-head[data-v-19b8580e]:hover:after{content:"+";position:absolute;left:0;right:0;top:0;bottom:0;color:#eee;background:rgba(0,0,0,.5);font-size:24px;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;cursor:pointer;line-height:110px;border-radius:50%}.img-circle[data-v-19b8580e]{border-radius:50%}.img-lg[data-v-19b8580e]{width:120px;height:120px}.avatar-upload-preview[data-v-19b8580e]{position:absolute;top:50%;transform:translate(50%,-50%);width:200px;height:200px;border-radius:50%;box-shadow:0 0 4px #ccc;overflow:hidden}',""]),e.exports=o},466:function(e,t,r){"use strict";r(453)},467:function(e,t,r){var o=r(28)(!1);o.push([e.i,".email-code{width:33%;height:38px;float:right}.email-code img{cursor:pointer;vertical-align:middle;height:38px}",""]),e.exports=o},483:function(e,t,r){var content=r(512);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(29).default)("99d57368",content,!1,{sourceMap:!1})},498:function(e,t,r){"use strict";r.r(t);var o=r(190),l={props:{user:{type:Object}},data:function(){return{open:!1,visible:!1,title:"修改头像",options:{img:"",autoCrop:!0,autoCropWidth:200,autoCropHeight:200,fixedBox:!0},previews:{}}},created:function(){1},watch:{user:function(e,t){this.options.img=this.handleCampusUrl(e.avatar)}},methods:{editCropper:function(){this.open=!0,this.visible=!0},modalOpened:function(){this.visible=!0},requestUpload:function(){},rotateLeft:function(){this.$refs.cropper.rotateLeft()},rotateRight:function(){this.$refs.cropper.rotateRight()},changeScale:function(e){e=e||1,this.$refs.cropper.changeScale(e)},beforeUpload:function(e){var t=this;if(-1==e.type.indexOf("image/"))this.$modal.msgError("文件格式错误，请上传图片类型,如：JPG，PNG后缀的文件。");else{var r=new FileReader;r.readAsDataURL(e),r.onload=function(){t.options.img=r.result}}},uploadImg:function(){var e=this;this.$refs.cropper.getCropBlob((function(data){var t=new FormData;t.append("avatarfile",data),o.a.uploadAvatar(t).then((function(t){e.open=!1,e.options.img=e.handleCampusUrl(t.imgUrl),e.$modal.msgSuccess("修改成功"),e.visible=!1}))}))},realTimeImg:function(data){this.previews=data},closeDialog:function(){this.options.img=this.handleCampusUrl(this.user.avatar),this.visible=!1}}},n=(r(464),r(18)),component=Object(n.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("client-only",[r("div",{staticClass:"user-info-head",on:{click:function(t){return e.editCropper()}}},[r("img",{staticClass:"img-circle img-lg",attrs:{src:e.options.img,title:"点击上传头像"}})]),e._v(" "),e.open?r("el-dialog",{attrs:{title:e.title,visible:e.open,width:"800px","append-to-body":""},on:{"update:visible":function(t){e.open=t},opened:e.modalOpened,close:e.closeDialog}},[r("el-row",[r("el-col",{style:{height:"350px"},attrs:{xs:24,md:12}},[r("client-only",[e.visible?r("VueCropper",{ref:"cropper",attrs:{img:e.options.img,info:!0,autoCrop:e.options.autoCrop,autoCropWidth:e.options.autoCropWidth,autoCropHeight:e.options.autoCropHeight,fixedBox:e.options.fixedBox},on:{"real-time":e.realTimeImg}}):e._e()],1)],1),e._v(" "),r("el-col",{style:{height:"350px"},attrs:{xs:24,md:12}},[r("div",{staticClass:"avatar-upload-preview"},[r("img",{style:e.previews.img,attrs:{src:e.previews.url}})])])],1),e._v(" "),r("br"),e._v(" "),r("el-row",[r("el-col",{attrs:{lg:2,md:2}},[r("el-upload",{attrs:{action:"#","http-request":e.requestUpload,"show-file-list":!1,"before-upload":e.beforeUpload}},[r("el-button",{attrs:{size:"small"}},[e._v("\n              选择\n              "),r("i",{staticClass:"el-icon-upload el-icon--right"})])],1)],1),e._v(" "),r("el-col",{attrs:{lg:{span:1,offset:2},md:2}},[r("el-button",{attrs:{icon:"el-icon-plus",size:"small"},on:{click:function(t){return e.changeScale(1)}}})],1),e._v(" "),r("el-col",{attrs:{lg:{span:1,offset:1},md:2}},[r("el-button",{attrs:{icon:"el-icon-minus",size:"small"},on:{click:function(t){return e.changeScale(-1)}}})],1),e._v(" "),r("el-col",{attrs:{lg:{span:1,offset:1},md:2}},[r("el-button",{attrs:{icon:"el-icon-refresh-left",size:"small"},on:{click:function(t){return e.rotateLeft()}}})],1),e._v(" "),r("el-col",{attrs:{lg:{span:1,offset:1},md:2}},[r("el-button",{attrs:{icon:"el-icon-refresh-right",size:"small"},on:{click:function(t){return e.rotateRight()}}})],1),e._v(" "),r("el-col",{attrs:{lg:{span:2,offset:6},md:2}},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.uploadImg()}}},[e._v("提 交")])],1)],1)],1):e._e()],1)],1)}),[],!1,null,"19b8580e",null);t.default=component.exports},499:function(e,t,r){"use strict";r.r(t);var o=r(190),l=r(191),n={components:{userEmail:r(463).default},props:{user:{type:Object}},data:function(){return{rules:{nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}]},emailRules:{email:[{required:!0,message:"邮箱地址不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]},{required:!0,validator:function(e,t,r){Object(l.b)(t).then((function(e){!0===e.data?r():r(new Error("邮箱已经存在"))}))},trigger:"blur"}]},dialogVisible:!1,emailForm:{email:"",code:"",uuid:""},codeUrl:"",loading:!1}},created:function(){},methods:{submit:function(){var e=this;this.$refs.form.validate((function(t){t&&o.a.updateUserProfile(e.user).then((function(t){e.$modal.msgSuccess("修改成功")}))}))},close:function(){this.$tab.closePage()},openDialog:function(){this.dialogVisible=!0},getCode:function(){var e=this;Object(l.f)().then((function(t){e.captchaEnabled=void 0===t.captchaEnabled||t.captchaEnabled,e.captchaEnabled&&(e.codeUrl="data:image/gif;base64,"+t.img,e.emailForm.uuid=t.uuid)}))},handleEmail:function(){}}},c=(r(466),r(18)),component=Object(c.a)(n,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"form",attrs:{model:e.user,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"用户昵称",prop:"nickName"}},[r("el-input",{attrs:{maxlength:"30"},model:{value:e.user.nickName,callback:function(t){e.$set(e.user,"nickName",t)},expression:"user.nickName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("div",{staticStyle:{display:"flex"}},[r("el-input",{attrs:{maxlength:"50"},model:{value:e.user.email,callback:function(t){e.$set(e.user,"email",t)},expression:"user.email"}})],1)]),e._v(" "),r("el-form-item",{attrs:{label:"性别"}},[r("el-radio-group",{model:{value:e.user.sex,callback:function(t){e.$set(e.user,"sex",t)},expression:"user.sex"}},[r("el-radio",{attrs:{label:"0"}},[e._v("男")]),e._v(" "),r("el-radio",{attrs:{label:"1"}},[e._v("女")])],1)],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.submit}},[e._v("保存")]),e._v(" "),r("el-button",{attrs:{type:"danger",size:"mini"},on:{click:e.close}},[e._v("关闭")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"更换邮箱",visible:e.dialogVisible,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[void 0!==e.user?r("userEmail",{attrs:{user:e.user}}):e._e()],1)],1)}),[],!1,null,null,null);t.default=component.exports},500:function(e,t,r){"use strict";r.r(t);var o=r(190),l={data:function(){var e=this;return{user:{oldPassword:void 0,newPassword:void 0,confirmPassword:void 0},rules:{oldPassword:[{required:!0,message:"旧密码不能为空",trigger:"blur"}],newPassword:[{required:!0,message:"新密码不能为空",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"确认密码不能为空",trigger:"blur"},{required:!0,validator:function(t,r,o){e.user.newPassword!==r?o(new Error("两次输入的密码不一致")):o()},trigger:"blur"}]}}},methods:{submit:function(){var e=this;this.$refs.form.validate((function(t){t&&o.a.updateUserPwd(e.user.oldPassword,e.user.newPassword).then((function(t){e.$modal.msgSuccess("修改成功")}))}))},close:function(){this.$tab.closePage()}}},n=r(18),component=Object(n.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{ref:"form",attrs:{model:e.user,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"旧密码",prop:"oldPassword"}},[r("el-input",{attrs:{placeholder:"请输入旧密码",type:"password","show-password":""},model:{value:e.user.oldPassword,callback:function(t){e.$set(e.user,"oldPassword",t)},expression:"user.oldPassword"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[r("el-input",{attrs:{placeholder:"请输入新密码",type:"password","show-password":""},model:{value:e.user.newPassword,callback:function(t){e.$set(e.user,"newPassword",t)},expression:"user.newPassword"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"确认密码",prop:"confirmPassword"}},[r("el-input",{attrs:{placeholder:"请确认新密码",type:"password","show-password":""},model:{value:e.user.confirmPassword,callback:function(t){e.$set(e.user,"confirmPassword",t)},expression:"user.confirmPassword"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.submit}},[e._v("保存")]),e._v(" "),r("el-button",{attrs:{type:"danger",size:"mini"},on:{click:e.close}},[e._v("关闭")])],1)],1)}),[],!1,null,null,null);t.default=component.exports},511:function(e,t,r){"use strict";r(483)},512:function(e,t,r){var o=r(28)(!1);o.push([e.i,".profile-container[data-v-6832e4be]{display:flex;justify-content:center;align-items:center;height:100%}.text-center[data-v-6832e4be]{text-align:center}",""]),e.exports=o},784:function(e,t,r){"use strict";r.r(t);var o=r(498),l=r(499),n=r(500),c=r(190),d={name:"Profile",components:{userAvatar:o.default,userInfo:l.default,resetPwd:n.default},data:function(){return{user:{},activeTab:"userinfo"}},created:function(){this.getUser()},methods:{getUser:function(){var e=this;c.a.getUserProfile().then((function(t){e.user=t.data}))}}},m=(r(511),r(18)),component=Object(m.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"profile-container"},[r("client-only",[r("el-card",{staticStyle:{width:"600px"}},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("基本资料")])]),e._v(" "),r("div",{staticClass:"box-card"},[r("div",{staticClass:"text-center"},[r("userAvatar",{attrs:{user:e.user}})],1)]),e._v(" "),r("el-tabs",{model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[r("el-tab-pane",{attrs:{label:"基本资料",name:"userinfo"}},[r("userInfo",{attrs:{user:e.user}})],1),e._v(" "),r("el-tab-pane",{attrs:{label:"修改密码",name:"resetPwd"}},[r("resetPwd")],1)],1)],1)],1)],1)}),[],!1,null,"6832e4be",null);t.default=component.exports}}]);