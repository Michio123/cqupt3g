(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{434:function(t,e,n){"use strict";var o=n(10);e.a={deletePin:function(t){return Object(o.a)({url:"".concat("/api/operate","/delComment"),method:"post",data:t})},deleteContent:function(t){return Object(o.a)({url:"campus/delContent/"+t,method:"delete"})},zanContent:function(t){return Object(o.a)({url:"campus/zan/"+t,method:"get"})},toComment:function(t){return Object(o.a)({url:"campus/toComment",method:"post",data:t})},publishContent:function(t){return Object(o.a)({url:"campus/sendContent",method:"post",data:t})},ownContents:function(t){return Object(o.a)({url:"campus/ownContents",method:"post",data:t})}}},435:function(t,e,n){"use strict";var o=n(10),c="/tourist";e.a={getUserByCids:function(t){return Object(o.a)({url:"".concat(c,"/content/")+t,method:"get"})},getpinlun:function(t){return Object(o.a)({url:"".concat(c,"/getComment/")+t,method:"get"})},getCategoryList:function(){return Object(o.a)({url:"/campus/categoryList",method:"get"})},getContent:function(t){return Object(o.a)({url:"/campus/contentList",method:"get",params:t})},getContentById:function(t){return Object(o.a)({url:"/campus/getContent",method:"get",params:{id:t}})},getOneLevelComment:function(t){return Object(o.a)({url:"/campus/getOneLevelComment",method:"get",params:t})},getCommentChildren:function(t){return Object(o.a)({url:"/campus/getCommentChildren",method:"get",params:t})},getSimpleHotContent:function(){return Object(o.a)({url:"/campus/simpleHotContent",method:"get"})},getUserCid:function(t){return Object(o.a)({url:"".concat(c,"/contents"),method:"post",data:t})},isExist:function(t){return Object(o.a)({url:"".concat(c,"/isExist"),method:"post",data:t})}}},484:function(t,e,n){var content=n(514);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(29).default)("2ecd7faa",content,!1,{sourceMap:!1})},513:function(t,e,n){"use strict";n(484)},514:function(t,e,n){var o=n(28)(!1);o.push([t.i,".iconbed-text[data-v-b37c0a9a]{margin:0 8px 0 2px;font-size:13px}.c-cascader[data-v-b37c0a9a]{border-radius:0}.mavonEditor[data-v-b37c0a9a]{width:100%;height:100%}",""]),t.exports=o},785:function(t,e,n){"use strict";n.r(e);var o=n(36),c=(n(97),n(272),n(192),n(55),n(16),n(54),n(65),n(44),n(31),n(39),n(66),n(67),n(40),n(434)),r=n(190),l=n(435),d=n(52);function h(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,r=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){l=!0,c=t},f:function(){try{r||null==n.return||n.return()}finally{if(l)throw c}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var f={data:function(){var t;return{props:{expandTrigger:"hover",value:"categoryId",label:"categoryName",children:"children"},contentParam:{categoryId:"",type:0,isAnonymous:0,content:"",fileList:[]},disabled:{picture:!1,video:!1},upload:{show:!1,action:"",limit:3,accept:"",listType:"",headers:{}},cascader:[],fileCount:0,fileList:[],categoryOptions:[],dialog:!0,selectType:0,markdownOption:(t={bold:!0},Object(o.a)(t,"bold",!0),Object(o.a)(t,"italic",!0),Object(o.a)(t,"header",!0),Object(o.a)(t,"underline",!0),Object(o.a)(t,"strikethrough",!0),Object(o.a)(t,"mark",!0),Object(o.a)(t,"superscript",!0),Object(o.a)(t,"subscript",!0),Object(o.a)(t,"quote",!0),Object(o.a)(t,"ol",!0),Object(o.a)(t,"ul",!0),Object(o.a)(t,"link",!0),Object(o.a)(t,"imagelink",!0),Object(o.a)(t,"code",!0),Object(o.a)(t,"table",!0),Object(o.a)(t,"fullscreen",!0),Object(o.a)(t,"readmodel",!0),Object(o.a)(t,"htmlcode",!0),Object(o.a)(t,"help",!0),Object(o.a)(t,"undo",!0),Object(o.a)(t,"redo",!0),Object(o.a)(t,"trash",!0),Object(o.a)(t,"save",!0),Object(o.a)(t,"navigation",!0),Object(o.a)(t,"alignleft",!0),Object(o.a)(t,"aligncenter",!0),Object(o.a)(t,"alignright",!0),Object(o.a)(t,"subfield",!0),Object(o.a)(t,"preview",!0),t),handbook:"#### how to use mavonEditor in nuxt.js",post:{content:"",html:""}}},created:function(){void 0===Object(d.a)()&&this.$router.push({path:"/userlogin"}),this.upload.headers.Authorization="Bearer "+Object(d.a)(),this.haveMail()},mounted:function(){this.$nextTick((function(){this.getTreeselect()}))},methods:{haveMail:function(){var t=this;r.a.haveMail().then((function(t){})).catch((function(e){var n=3,o=setInterval((function(){--n<=0?(clearInterval(o),t.$router.push({path:"/user/profile"})):t.$message.warning("将再 "+n+" 秒后跳转到绑定邮箱页面")}),1e3)}))},selectPicture:function(){this.upload.action=this.handleCampusUrl("/campus/imageUpload"),this.upload.limit=3,this.upload.accept="image/*",this.upload.listType="picture-card",this.selectType=1,document.getElementById("uploadBtn").click()},selectVideo:function(){console.log("选择视频"),this.upload.action=this.handleCampusUrl("/campus/videoUpload"),this.upload.limit=1,this.upload.accept="video/*",this.upload.listType="text",this.selectType=2,document.getElementById("uploadBtn").click()},getTreeselect:function(){var t=this;l.a.getCategoryList().then((function(e){for(var n=e.data,i=0;i<n.length;i++)"Y"==n[i].type&&n.splice(i,1);t.categoryOptions=t.handleTree(n,"categoryId")}))},handleRemove:function(t,e){console.log(t,e),this.checkBtn()},handlePreview:function(t){console.log(t)},handleSuccess:function(t,e,n){var o=this;200!=t.code&&(n.splice(n.length-1,1),this.$message.warning(t.msg),setTimeout((function(){o.$message.error("上传失败，请重新上传")}),1e3)),this.checkBtn()},handleError:function(t,e,n){this.$message.error("上传失败"),this.checkBtn()},handleChange:function(t,e){console.log(t),this.fileList=e;var n=e.length;this.fileCount<n&&(t.raw.type.startsWith("image")?this.disabled.video=!0:this.disabled.picture=!0,this.validated(t),this.$refs.upload.submit()),this.fileCount=n,n>0&&(this.upload.show=!0),this.checkBtn()},handleExceed:function(t,e){this.$message.warning("上传数量超过限制")},validated:function(t){var e=t.size/1024/1024;1==this.selectType?(t.raw.type.startsWith("image")||(this.$message.warning("请选择图片"),this.fileList.splice(this.fileList.length-1,1)),e>5&&(this.fileList.splice(this.fileList.length-1,1),this.$message.warning("上传的图片大小不能超过 5MB!"))):(t.raw.type.startsWith("video")||(this.$message.warning("请选择视频"),this.fileList.splice(this.fileList.length-1,1)),e>20&&(this.fileList.splice(this.fileList.length-1,1),this.$message.warning("上传的视频大小不能超过 20MB!")))},checkBtn:function(){0==this.fileList.length&&(this.upload.show=!1,this.disabled.picture=!1,this.disabled.video=!1)},publishContent:function(){var t=this;this.contentParam.fileList=[],console.log(this.fileList);var e,n=h(this.fileList);try{for(n.s();!(e=n.n()).done;){var o=e.value;o.raw.type.startsWith("image")&&(this.contentParam.type=1),o.raw.type.startsWith("video")&&(this.contentParam.type=2),void 0!==o.response&&200==o.response.code?this.contentParam.fileList.push(o.response.data.fileId):console.log("禁止")}}catch(t){n.e(t)}finally{n.f()}2==this.cascader.length?(this.contentParam.categoryId=this.cascader[1],c.a.publishContent(this.contentParam).then((function(e){t.$router.push({path:"/User/management?types=1"})}))):this.$message.warning("请选择分类")},updateDoc:function(t,e){this.html=e,this.markdown=t},saveDoc:function(t,e){this.html=e,this.markdown=t}}},v=f,y=(n(513),n(18)),component=Object(y.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"publish-content"},[n("el-row",[n("el-col",{attrs:{span:8,xs:20}},[n("el-dialog",{attrs:{title:"快捷发布",visible:t.dialog,width:"600px;"},on:{"update:visible":function(e){t.dialog=e}}},[n("div",[n("div",[n("v-container",{attrs:{fluid:""}},[n("mavon-editor",{staticStyle:{width:"100%",height:"800px"},attrs:{toolbars:t.markdownOption,ishljs:!0},on:{change:t.updateDoc,save:t.saveDoc},model:{value:t.contentParam.content,callback:function(e){t.$set(t.contentParam,"content",e)},expression:"contentParam.content"}})],1),t._v(" "),n("div",{staticClass:"woo-box-flex woo-box-alignCenter"},[n("div",{staticClass:"woo-box-item-flex",staticStyle:{"align-self":"center"}},[n("div",{staticClass:"woo-box-item-inlineBlock"},[n("el-cascader",{staticClass:"c-cascader",attrs:{size:"small",placeholder:"请选择分类",options:t.categoryOptions,props:t.props},model:{value:t.cascader,callback:function(e){t.cascader=e},expression:"cascader"}})],1),t._v(" "),n("el-switch",{attrs:{"active-value":"1","inactive-value":"0","active-text":"匿名","inactive-text":"不匿名"},model:{value:t.contentParam.isAnonymous,callback:function(e){t.$set(t.contentParam,"isAnonymous",e)},expression:"contentParam.isAnonymous"}}),t._v(" "),n("div",{staticClass:"woo-box-item-inlineBlock"},[n("el-button",{attrs:{type:"text",disabled:t.disabled.picture},on:{click:function(e){return t.selectPicture()}}},[n("svg-icon",{staticClass:"woo-font woo-font--emotico",staticStyle:{width:"18px",height:"18px"},attrs:{"icon-class":"picture"}}),t._v(" "),n("span",{staticClass:"iconbed-text"},[t._v("图片")])],1)],1),t._v(" "),n("div",{staticClass:"woo-box-item-inlineBlock"},[n("el-button",{attrs:{type:"text",disabled:t.disabled.video},on:{click:function(e){return t.selectVideo()}}},[n("svg-icon",{staticClass:"woo-font woo-font--emotico",staticStyle:{width:"18px",height:"18px"},attrs:{"icon-class":"video"}}),t._v(" "),n("span",{staticClass:"iconbed-text"},[t._v("视频")])],1)],1)],1),t._v(" "),n("el-button",{staticStyle:{"margin-top":"15px"},attrs:{type:"primary",round:"",disabled:t.contentParam.content.length<=0},on:{click:function(e){return t.publishContent()}}},[t._v("\n                发布\n              ")])],1),t._v(" "),n("el-upload",{directives:[{name:"show",rawName:"v-show",value:t.upload.show,expression:"upload.show"}],ref:"upload",staticStyle:{height:"15x"},attrs:{headers:t.upload.headers,limit:t.upload.limit,action:t.upload.action,"show-file-list":!0,"list-type":t.upload.listType,accept:t.upload.accept,"auto-upload":!1,"on-change":t.handleChange,"on-preview":t.handlePreview,"on-remove":t.handleRemove,"on-exceed":t.handleExceed,"on-success":t.handleSuccess,"on-error":t.handleError}},[n("button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{id:"uploadBtn"}})])],1)])])],1)],1)],1)}),[],!1,null,"b37c0a9a",null);e.default=component.exports;installComponents(component,{SvgIcon:n(189).default})}}]);